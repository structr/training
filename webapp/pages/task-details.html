<!-- @structr:owner(admin), @structr:grant(admin,arwd), @structr:content(text/html) --><structr:template src="Main Page Template-fc86242194c44060a7fac0d1804df054" data-structr-meta-name="Main Page Template">
	<!-- @structr:owner(admin), @structr:grant(admin,arwd) -->
	<h1><!-- @structr:owner(admin), @structr:grant(admin,arwd), @structr:content(text/plain) -->${current.name}</h1>
	<!-- @structr:owner(admin), @structr:grant(admin,arwd), @structr:content(text/html) --><structr:template src="9e071a2b50514a779a942eda30178cbe">
		<!-- @structr:owner(admin), @structr:grant(admin,arwd) -->
		<div style="padding: 2em 1em;" data-structr-meta-name="Details">
			<!-- @structr:owner(admin), @structr:grant(admin,arwd) -->
			<div>
				<!-- @structr:owner(admin), @structr:grant(admin,arwd) -->
				<label><!-- @structr:owner(admin), @structr:grant(admin,arwd), @structr:content(text/plain) -->Project</label>
				<!-- @structr:owner(admin), @structr:grant(admin,arwd) -->
				<p><!-- @structr:owner(admin), @structr:grant(admin,arwd), @structr:content(text/plain) -->${current.project.name}</p>
			</div>
			<!-- @structr:owner(admin), @structr:grant(admin,arwd) -->
			<div>
				<!-- @structr:owner(admin), @structr:grant(admin,arwd) -->
				<label><!-- @structr:owner(admin), @structr:grant(admin,arwd), @structr:content(text/plain) -->Description</label>
				<!-- @structr:owner(admin), @structr:grant(admin,arwd) -->
				<p><!-- @structr:owner(admin), @structr:grant(admin,arwd), @structr:content(text/plain) -->${current.description}</p>
			</div>
			<!-- @structr:owner(admin), @structr:grant(admin,arwd) -->
			<div>
				<!-- @structr:owner(admin), @structr:grant(admin,arwd) -->
				<label><!-- @structr:owner(admin), @structr:grant(admin,arwd), @structr:content(text/plain) -->Duration in Days</label>
				<!-- @structr:owner(admin), @structr:grant(admin,arwd) -->
				<p><!-- @structr:owner(admin), @structr:grant(admin,arwd), @structr:content(text/plain) -->${current.durationInDays}</p>
			</div>
		</div>
		<!-- @structr:owner(admin), @structr:grant(admin,arwd) -->
		<div style="padding: 2em 1em;" data-structr-meta-name="Vanilla Editing">
			<!-- @structr:owner(admin), @structr:grant(admin,arwd) -->
			<div>
				<!-- @structr:owner(admin), @structr:grant(admin,arwd) -->
				<label><!-- @structr:owner(admin), @structr:grant(admin,arwd), @structr:content(text/plain) -->Name</label>
				<!-- @structr:owner(admin), @structr:grant(admin,arwd) -->
				<p>
					<!-- @structr:owner(admin), @structr:grant(admin,arwd) -->
					<input id="name" value="${current.name}">
				</p>
			</div>
			<!-- @structr:owner(admin), @structr:grant(admin,arwd) -->
			<div>
				<!-- @structr:owner(admin), @structr:grant(admin,arwd) -->
				<label><!-- @structr:owner(admin), @structr:grant(admin,arwd), @structr:content(text/plain) -->Project</label>
				<!-- @structr:owner(admin), @structr:grant(admin,arwd) -->
				<p>
					<!-- @structr:owner(admin), @structr:grant(admin,arwd) -->
					<select id="project">
						<!-- @structr:owner(admin), @structr:grant(admin,arwd) -->
						<option></option>
						<!-- @structr:owner(admin), @structr:grant(admin,arwd) -->
						<option selected="${is(equal(current.project, project), 'selected')}" value="${project.id}" data-structr-meta-data-key="project" data-structr-meta-function-query="find('PM_Project', sort('name'))"><!-- @structr:owner(admin), @structr:grant(admin,arwd), @structr:content(text/plain) -->${project.name}</option>
					</select>
				</p>
			</div>
			<!-- @structr:owner(admin), @structr:grant(admin,arwd) -->
			<div>
				<!-- @structr:owner(admin), @structr:grant(admin,arwd) -->
				<label><!-- @structr:owner(admin), @structr:grant(admin,arwd), @structr:content(text/plain) -->Description</label>
				<!-- @structr:owner(admin), @structr:grant(admin,arwd) -->
				<p><!-- @structr:owner(admin), @structr:grant(admin,arwd) --><textarea id="description"><!-- @structr:owner(admin), @structr:grant(admin,arwd), @structr:content(text/plain) -->${current.description}</textarea></p>
			</div>
			<!-- @structr:owner(admin), @structr:grant(admin,arwd) -->
			<div>
				<!-- @structr:owner(admin), @structr:grant(admin,arwd) -->
				<label><!-- @structr:owner(admin), @structr:grant(admin,arwd), @structr:content(text/plain) -->Duration in Days</label>
				<!-- @structr:owner(admin), @structr:grant(admin,arwd) -->
				<p>
					<!-- @structr:owner(admin), @structr:grant(admin,arwd) -->
					<input id="duration-in-days" type="number" value="${current.durationInDays}">
				</p>
			</div>
			<!-- @structr:owner(admin), @structr:grant(admin,arwd) -->
			<div>
				<!-- @structr:owner(admin), @structr:grant(admin,arwd) -->
				<button class="btn btn-success" id="save-button"><!-- @structr:owner(admin), @structr:grant(admin,arwd), @structr:content(text/plain) -->Save</button>
				<!-- @structr:owner(admin), @structr:grant(admin,arwd) -->
				<button class="btn btn-danger" id="delete-button"><!-- @structr:owner(admin), @structr:grant(admin,arwd), @structr:content(text/plain) -->Delete</button>
			</div>
		</div>
	</structr:template>
<!-- @structr:owner(admin), @structr:grant(admin,arwd) --><a class="btn btn-primary" href="/tasks"><!-- @structr:owner(admin), @structr:grant(admin,arwd), @structr:content(text/plain) -->Back to tasks list</a>
	<!-- @structr:owner(admin), @structr:grant(admin,arwd) -->
	<script type="text/javascript"><!-- @structr:owner(admin), @structr:grant(admin,arwd), @structr:content(text/javascript) -->async function saveTask() {

	// collect input elements
	const name           = document.getElementById('name');
	const project        = document.getElementById('project');
	const description    = document.getElementById('description');
	const durationInDays = document.getElementById('duration-in-days');
	
	// collect data
	const data = {
		name : name.value,
		project : project.value,
		description : description.value,
		durationInDays : durationInDays.value
	};
	
	let taskId = '${current.id}';
	
	// update existing task
	if(taskId !== '') {
	
		await fetch('/structr/rest/PM_Task/' + taskId, {
			method : 'PUT',
			body   : JSON.stringify(data)
		});
	
	}
	
	// create new task
	else {
	
		const response = await fetch('/structr/rest/PM_Task', {
        	method: 'POST',
        	body: JSON.stringify(data),
    	});
		
		const jsonResponse = await response.json();
		taskId = jsonResponse.result[0];
		
	}
	
	// reload page
	window.location.href = '/task-details/' + taskId;

}

document.addEventListener('DOMContentLoaded', function(event) {
	
    // hook save button
    const saveButton = document.getElementById('save-button');
    if(saveButton) {
        saveButton.addEventListener('click', saveTask);
    }

});</script>
</structr:template>
